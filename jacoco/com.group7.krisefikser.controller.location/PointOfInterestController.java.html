<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PointOfInterestController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">krisefikser</a> &gt; <a href="index.source.html" class="el_package">com.group7.krisefikser.controller.location</a> &gt; <span class="el_source">PointOfInterestController.java</span></div><h1>PointOfInterestController.java</h1><pre class="source lang-java linenums">package com.group7.krisefikser.controller.location;

import com.group7.krisefikser.dto.request.location.GetPointsOfInterestRequest;
import com.group7.krisefikser.dto.request.location.PointOfInterestRequest;
import com.group7.krisefikser.dto.response.location.PointOfInterestResponse;
import com.group7.krisefikser.dto.response.other.ErrorResponse;
import com.group7.krisefikser.enums.PointOfInterestType;
import com.group7.krisefikser.service.location.PointOfInterestService;
import com.group7.krisefikser.utils.ValidationUtils;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.enums.ParameterIn;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import java.net.URI;
import java.util.List;
import java.util.logging.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.support.ServletUriComponentsBuilder;


/**
 * Controller class for handling requests related to points of interest.
 * This class will contain endpoints for retrieving points of interest based on type.
 * It will use the PointOfInterestService to perform the necessary operations.
 */
@RestController
@RequestMapping(&quot;/api/point-of-interest&quot;)
@Tag(name = &quot;Point of Interest&quot;, description = &quot;Endpoints for managing points of interest&quot;)
public class PointOfInterestController {
  private final PointOfInterestService pointOfInterestService;

<span class="fc" id="L48">  private static final Logger logger = Logger.getLogger(PointOfInterestController.class.getName());</span>

  /**
   * Constructor for PointOfInterestController.
   * This constructor is used for dependency injection of the PointOfInterestService.
   *
   * @param pointOfInterestService The service to be injected.
   */
  @Autowired
<span class="fc" id="L57">  public PointOfInterestController(PointOfInterestService pointOfInterestService) {</span>
<span class="fc" id="L58">    this.pointOfInterestService = pointOfInterestService;</span>
<span class="fc" id="L59">  }</span>

  /**
   * Endpoint to get points of interest based on type.
   * This endpoint will accept a request containing a list of point of interest types
   *
   * @param request The request containing the types of points of interest to be retrieved.
   * @return ResponseEntity containing a list of PointOfInterestResponse objects.
   */
  @Operation(
          summary = &quot;Get points of interest by types&quot;,
          description = &quot;Retrieves a list of points of interest based on the &quot;
                  + &quot;provided types in the query parameters.&quot;,
          parameters = @Parameter(
                  name = &quot;types&quot;,
                  description = &quot;List of point of interest types to filter by. &quot;
                          + &quot;Valid types are: shelter, food_central, water_station, &quot;
                          + &quot;defibrillator, hospital. Multiple types can be provided &quot;
                          + &quot;by repeating the 'types' parameter in the URL &quot;
                          + &quot;(e.g., /api/poi?types=shelter&amp;types=food_central).&quot;,
                  required = true,
                  schema = @Schema(type = &quot;array&quot;,
                          enumAsRef = true,
                          implementation = PointOfInterestType.class)
          ),
          responses = {
            @ApiResponse(responseCode = &quot;200&quot;,
                    description = &quot;Successfully retrieved points of interest&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation =
                                    PointOfInterestResponse.class))),
            @ApiResponse(responseCode = &quot;400&quot;,
                    description = &quot;Invalid point of interest type provided&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = List.class))),
            @ApiResponse(responseCode = &quot;500&quot;,
                    description = &quot;Internal server error&quot;,
                    content = @Content(mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = List.class)))
          }
  )
  @GetMapping
  public ResponseEntity&lt;List&lt;PointOfInterestResponse&gt;&gt; getPointsOfInterest(
          @ModelAttribute GetPointsOfInterestRequest request) {
<span class="fc" id="L103">    logger.info(&quot;Received request to get points of interest with types: &quot;</span>
<span class="fc" id="L104">            + request.getTypes());</span>
    try {
<span class="fc" id="L106">      List&lt;PointOfInterestResponse&gt; pointsOfInterest = pointOfInterestService</span>
<span class="fc" id="L107">              .getPointsOfInterestByTypes(request);</span>
<span class="fc" id="L108">      logger.info(&quot;Successfully retrieved points of interest&quot;);</span>
<span class="fc" id="L109">      return ResponseEntity.ok(pointsOfInterest);</span>
<span class="fc" id="L110">    } catch (IllegalArgumentException e) {</span>
<span class="fc" id="L111">      logger.info(&quot;Error retrieving points of interest: &quot; + e.getMessage());</span>
<span class="fc" id="L112">      return ResponseEntity.badRequest().body(List.of());</span>
<span class="fc" id="L113">    } catch (Exception e) {</span>
<span class="fc" id="L114">      logger.severe(&quot;Unexpected error: &quot; + e.getMessage());</span>
<span class="fc" id="L115">      return ResponseEntity.status(500).body(List.of());</span>
    }
  }

  /**
   * Endpoint to add a new point of interest.
   * This endpoint will accept a request containing the details of the point of
   * interest to be added.
   *
   * @param pointOfInterestRequest The request containing the details of the
   *                               point of interest to be added.
   * @return ResponseEntity containing the added PointOfInterestResponse object.
   */
  @Operation(
          summary = &quot;Add a new point of interest&quot;,
          description = &quot;Creates a new point of interest based on the provided details.&quot;,
          requestBody = @io.swagger.v3.oas.annotations.parameters.RequestBody(
                  required = true,
                  description = &quot;Details of the point of interest to add&quot;,
                  content = @Content(
                          mediaType = MediaType.APPLICATION_JSON_VALUE,
                          schema = @Schema(implementation = PointOfInterestRequest.class)
                  )
          ),
          responses = {
            @ApiResponse(responseCode = &quot;201&quot;, description =
                    &quot;Successfully created the new point of interest&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = PointOfInterestResponse.class))),
            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid request payload&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = ErrorResponse.class))),
            @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Internal server error&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = ErrorResponse.class)))
          }
  )
  @PostMapping
  public ResponseEntity&lt;Object&gt; addPointOfInterest(
          @Valid @RequestBody PointOfInterestRequest pointOfInterestRequest,
          BindingResult bindingResult) {
<span class="fc" id="L156">    logger.info(&quot;Received request to add a new point of interest&quot;);</span>

<span class="fc bfc" id="L158" title="All 2 branches covered.">    if (bindingResult.hasErrors()) {</span>
<span class="fc" id="L159">      return ValidationUtils.handleValidationErrors(bindingResult);</span>
    }

    try {
<span class="fc" id="L163">      PointOfInterestResponse addedPoint = pointOfInterestService</span>
<span class="fc" id="L164">              .addPointOfInterest(pointOfInterestRequest);</span>
<span class="fc" id="L165">      URI location = ServletUriComponentsBuilder.fromCurrentRequest()</span>
<span class="fc" id="L166">              .path(&quot;/{id}&quot;)</span>
<span class="fc" id="L167">              .buildAndExpand(addedPoint.getId())</span>
<span class="fc" id="L168">              .toUri();</span>
<span class="fc" id="L169">      logger.info(&quot;Successfully added point of interest&quot;);</span>
<span class="fc" id="L170">      return ResponseEntity.created(location).body(addedPoint);</span>
<span class="nc" id="L171">    } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L172">      logger.info(&quot;Error adding point of interest: &quot; + e.getMessage());</span>
<span class="nc" id="L173">      return ResponseEntity.badRequest().body(new ErrorResponse(</span>
<span class="nc" id="L174">              &quot;Invalid point of interest details provided: &quot; + e.getMessage()</span>
      ));
<span class="fc" id="L176">    } catch (Exception e) {</span>
<span class="fc" id="L177">      logger.severe(&quot;Unexpected error: &quot; + e.getMessage());</span>
<span class="fc" id="L178">      return ResponseEntity.status(500).body(new ErrorResponse(</span>
<span class="fc" id="L179">              &quot;Internal server error while adding point of interest: &quot; + e.getMessage()</span>
      ));
    }
  }

  /**
   * Endpoint to delete a point of interest.
   * This endpoint will accept a request containing the ID of the point of interest to be deleted.
   *
   * @param id The ID of the point of interest to be deleted.
   * @return ResponseEntity indicating the result of the deletion operation.
   */
  @Operation(
          summary = &quot;Delete a point of interest&quot;,
          description = &quot;Deletes a specific point of interest identified by its ID.&quot;,
          parameters = {
            @Parameter(name = &quot;id&quot;, in = ParameterIn.PATH, required = true,
                    description = &quot;ID of the point of interest to delete&quot;,
                    schema = @Schema(type = &quot;integer&quot;, format = &quot;int64&quot;))
          },
          responses = {
            @ApiResponse(responseCode = &quot;204&quot;,
                    description = &quot;Successfully deleted the point of interest&quot;),
            @ApiResponse(responseCode = &quot;400&quot;,
                    description = &quot;Invalid point of interest ID provided&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = ErrorResponse.class))),
            @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Internal server error&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = ErrorResponse.class)))
          }
  )
  @DeleteMapping(&quot;/{id}&quot;)
  public ResponseEntity&lt;Object&gt; deletePointOfInterest(@PathVariable Long id) {
<span class="fc" id="L213">    logger.info(&quot;Received request to delete point of interest with ID: &quot; + id);</span>
    try {
<span class="fc" id="L215">      pointOfInterestService.deletePointOfInterest(id);</span>
<span class="fc" id="L216">      logger.info(&quot;Successfully deleted point of interest with ID: &quot; + id);</span>
<span class="fc" id="L217">      return ResponseEntity.noContent().build();</span>
<span class="fc" id="L218">    } catch (IllegalArgumentException e) {</span>
<span class="fc" id="L219">      logger.info(&quot;Error deleting point of interest: &quot; + e.getMessage());</span>
<span class="fc" id="L220">      return ResponseEntity.badRequest().body(new ErrorResponse(</span>
<span class="fc" id="L221">              &quot;Invalid point of interest ID provided: &quot; + e.getMessage()</span>
      ));
<span class="fc" id="L223">    } catch (Exception e) {</span>
<span class="fc" id="L224">      logger.severe(&quot;Unexpected error: &quot; + e.getMessage());</span>
<span class="fc" id="L225">      return ResponseEntity.status(500).body(new ErrorResponse(</span>
<span class="fc" id="L226">              &quot;Internal server error while deleting point of interest: &quot; + e.getMessage()</span>
      ));
    }
  }

  /**
   * Endpoint to update an existing point of interest.
   * This endpoint will accept a request containing the ID of the point of interest
   * to be updated and the new details for the point of interest.
   *
   * @param id                     The ID of the point of interest to be updated.
   * @param pointOfInterestRequest The request containing the new details for the
   *                               point of interest.
   * @return ResponseEntity containing the updated PointOfInterestResponse object.
   */
  @Operation(
          summary = &quot;Update an existing point of interest&quot;,
          description = &quot;Updates the details of a specific point of interest identified by its ID.&quot;,
          parameters = {
            @Parameter(name = &quot;id&quot;, in = ParameterIn.PATH, required = true,
                    description = &quot;ID of the point of interest to update&quot;,
                    schema = @Schema(type = &quot;integer&quot;, format = &quot;int64&quot;)),
          },
          requestBody = @io.swagger.v3.oas.annotations.parameters.RequestBody(
                  required = true,
                  description = &quot;Point of interest details to be updated&quot;,
                  content = @Content(
                          mediaType = MediaType.APPLICATION_JSON_VALUE,
                          schema = @Schema(implementation = PointOfInterestRequest.class)
                  )
          ),
          responses = {
            @ApiResponse(responseCode = &quot;200&quot;,
                    description = &quot;Successfully updated the point of interest&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = PointOfInterestResponse.class))),
            @ApiResponse(responseCode = &quot;400&quot;,
                    description = &quot;Invalid request payload or parameters&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = ErrorResponse.class))),
            @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Internal server error&quot;,
                    content = @Content(mediaType = MediaType.APPLICATION_JSON_VALUE,
                            schema = @Schema(implementation = ErrorResponse.class)))
          }
  )
  @PutMapping(&quot;/{id}&quot;)
  public ResponseEntity&lt;Object&gt; updatePointOfInterest(
          @PathVariable Long id,
          @Valid @RequestBody PointOfInterestRequest pointOfInterestRequest,
          BindingResult bindingResult) {
<span class="fc" id="L276">    logger.info(&quot;Received request to update point of interest with ID: &quot; + id);</span>

<span class="fc bfc" id="L278" title="All 2 branches covered.">    if (bindingResult.hasErrors()) {</span>
<span class="fc" id="L279">      return ValidationUtils.handleValidationErrors(bindingResult);</span>
    }

    try {
<span class="fc" id="L283">      PointOfInterestResponse updatedPoint = pointOfInterestService</span>
<span class="fc" id="L284">              .updatePointOfInterest(id, pointOfInterestRequest);</span>
<span class="fc" id="L285">      logger.info(&quot;Successfully updated point of interest with ID: &quot; + id);</span>
<span class="fc" id="L286">      return ResponseEntity.ok(updatedPoint);</span>
<span class="nc" id="L287">    } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L288">      logger.info(&quot;Error updating point of interest: &quot; + e.getMessage());</span>
<span class="nc" id="L289">      return ResponseEntity.badRequest().body(new ErrorResponse(</span>
<span class="nc" id="L290">              &quot;Invalid point of interest details provided: &quot; + e.getMessage()</span>
      ));
<span class="fc" id="L292">    } catch (Exception e) {</span>
<span class="fc" id="L293">      logger.severe(&quot;Unexpected error: &quot; + e.getMessage());</span>
<span class="fc" id="L294">      return ResponseEntity.status(500).body(new ErrorResponse(</span>
<span class="fc" id="L295">              &quot;Internal server error while updating point of interest: &quot; + e.getMessage()</span>
      ));
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>